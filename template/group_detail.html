<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Group Details • ChatFlow</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1220; --card:#111827; --panel:#1f2937; --input:#0f172a;
  --text:#e5e7eb; --muted:#9ca3af; --primary:#6366f1; --success:#22c55e;
  --danger:#ef4444; --radius:16px;
}
*{box-sizing:border-box;font-family:Inter;margin:0;padding:0;}
body{background:linear-gradient(135deg,#0b1220,#020617);color:var(--text);min-height:100vh;}
.container{max-width:700px;margin:auto;padding:20px;}
.card{background:var(--card);border-radius:22px;overflow:hidden;box-shadow:0 40px 80px rgba(0,0,0,.45);}
.header{padding:30px 20px;text-align:center;}
.header .group-avatar{width:100px;height:100px;border-radius:50%;background:var(--primary);display:grid;place-items:center;font-size:36px;font-weight:700;margin:auto;cursor:pointer;}
.header h2{margin:12px 0 6px;}
.header p{color:#c7d2fe;font-size:13px;margin-bottom:4px;}
.section{padding:20px;background:var(--panel);border-radius:var(--radius);margin-bottom:20px;}
.section h3{margin-bottom:14px;color:#c7d2fe;font-size:15px;}
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.info-grid div{margin-bottom:8px;}
.info-grid div strong{display:block;font-size:14px;color:#e0e7ff;margin-bottom:2px;}
.info-grid div small{font-size:12px;color:var(--muted);}
.members-list{display:flex;flex-wrap:wrap;gap:12px;margin-top:10px;max-height:200px;overflow-y:auto;padding-right:4px;}
.member-item{display:flex;flex-direction:column;align-items:center;width:50px;}
.member-item .avatar{width:40px;height:40px;border-radius:50%;background:var(--primary);object-fit:cover;}
.member-item small{margin-top:4px;font-size:11px;color:var(--muted);text-align:center;max-width:50px;overflow:hidden;text-overflow:ellipsis;word-break:break-word;line-height:1.2;max-height:2.4em;}
.qr-container{display:flex;align-items:center;justify-content:center;margin-top:10px;cursor:pointer;}
.qr-container img{width:180px;height:180px;border-radius:12px;background:#0f172a;}
.link-input{background:var(--input);border:none;border-radius:12px;padding:10px;color:var(--text);width:100%;margin-top:6px;}
button{width:100%;padding:14px;border:none;border-radius:14px;background:var(--primary);color:white;font-weight:600;cursor:pointer;margin-top:10px;}

/* Modal */
.modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.modal.show{display:flex;}
.modal-content{max-width:90%;max-height:90%;border-radius:16px;display:grid;place-items:center;animation:zoomIn .3s ease;}
.modal-content img,
.modal-content .big-avatar{max-width:100%;max-height:100%;border-radius:16px;}
.big-avatar{width:240px;height:240px;border-radius:50%;background:var(--primary);display:grid;place-items:center;font-size:90px;font-weight:700;}

/* ✅ UPDATED AVATAR */

.avatar-container{
  position:relative;
  width:110px;
  height:110px;
  margin:auto;
}


.avatar-img{
  width:110px;
  height:110px;
  border-radius:50%;
  object-fit:cover;
  background:#0f172a;
  cursor:pointer;
}

.online{
  width:14px;
  height:14px;
  background:var(--success);
  border-radius:50%;
  position:absolute;
  bottom:8px;
  right:8px;
  border:3px solid #0f172a;
}

.danger{
  background-color: #dc3737;
}

/* Animations */
@keyframes zoomIn{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}
@media(max-width:640px){.info-grid{grid-template-columns:1fr}; .members-list{justify-content:flex-start};}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <div class="header">

      <div class="avatar-container">
        <img
          src="{{ chatroom.image.url }}"
          alt="Profile Image"
          id="avatarDisplay"
          class="avatar-img"
          onclick="openAvatar()"
        >
        <span class="online"></span>
      </div>
      <!-- <div class="group-avatar" id="groupAvatar" onclick="openModal('avatar')">D</div> -->
      <h2>{{chatroom.name}}</h2>
      <p>{{chatroom.about}}</p>
      <p>Admin: {{chatroom.admin}}</p>
    </div>

    <!-- Group Info -->
    <div class="section">
      <h3>Group Info</h3>
      <div class="info-grid">
        <div><strong>Created On : </strong><small>{{chatroom.created}}</small></div>
        <div><strong>Members Count : </strong><small>{{members_count}}</small></div>
        <div><strong>Status : </strong><small>Active</small></div>
        <div><strong>Descriptio :</strong><small>{{chatroom.discription}}</small></div>
      </div>
    </div>

    <!-- Chat Link & QR -->
    <div class="section">
      <h3>Chat Link & QR Code</h3>
      <input class="link-input" type="text" readonly value="http://localhost:8000/{{group_url}}">
      <div class="qr-container" onclick="openModal('qr')">
        {% if chatroom.QR_code %}
          <img id="qrImg" src="{{chatroom.QR_code.url}}">
        {% endif %}
      </div>
    </div>

    <!-- Members -->
    <div class="section">
      <h3>Members</h3>
      <div class="members-list">
        {% for group in chatroom.members.all %}
        <div class="member-item">
          <img src="{{ group.image.url }}" alt="{{group.user.username}}" class="avatar">
          <small>{{group.user.username}}</small>
        </div>
        {% endfor %}
      </div>
    </div>
    <a href="/chat/{{chatroom.id}}"><button onclick="goBack()">Back to Group.</button></a>
    <a href="/remove_user_from_group/{{chatroom.id}}/{{request.user.id}}"><button class="danger">Leave Group</button></a>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modal" onclick="closeModal()">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
/* Truncate member names to first 10 characters */
function truncateMemberNames(){
  const members = document.querySelectorAll('.member-item small');
  members.forEach(small => {
    if(small.textContent.length > 10){
      small.textContent = small.textContent.substring(0, 10);
    }
  });
}
document.addEventListener('DOMContentLoaded', truncateMemberNames);

/* Avatar zoom function */
function openAvatar(){
  const modal = document.getElementById('modal');
  const modalContent = document.getElementById('modalContent');
  const avatarImg = document.getElementById('avatarDisplay');
  modalContent.innerHTML = '';
  const img = document.createElement('img');
  img.src = avatarImg.src;
  img.style.maxWidth = '95vw';
  img.style.maxHeight = '95vh';
  img.style.width = '100%';
  img.style.height = '100%';
  img.style.borderRadius = '0';
  img.style.objectFit = 'contain';
  modalContent.appendChild(img);
  modal.classList.add('show');
}

/* Close modal */
function closeModal(){
  document.getElementById('modal').classList.remove('show');
}

/* Open modal for QR */
function openModal(type){
  const modal = document.getElementById('modal');
  const content = document.getElementById('modalContent');
  content.innerHTML = '';
  if(type==='qr'){
    const qrImg = document.getElementById('qrImage').cloneNode(true);
    content.appendChild(qrImg);
  }
  modal.classList.add('show');
}

function goBack(){ window.location.href="/"; }
</script>

</body>
</html>
